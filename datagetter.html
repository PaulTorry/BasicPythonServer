<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Hosted datalogger program v0.1</title>
    <link rel="stylesheet" href="style.css">
  </head>
  <body>

    <button onclick="getData()">Start</button>
    <button onclick="downloadAll()">Download</button>
    <button onclick="start()">start</button>

    <label for="ip">IP</label>
   <input type="text" id="ip" name="ip" value="http://192.168.178.187:8080"><br><br>

  </body>

  <script>
        
    let data = []

    async function start(){
      //console.log("Starting run")
      const url = document.getElementById("ip").value + "/startRun"
      console.log("Starting run:   ", url);
      try {
        const response = await fetch(url);
        if (!response.ok) {
          throw new Error(`Response status: ${response.status}`);
        }
        const json = await response.text();
        console.log(json);
      } catch (error) {
        console.error(error.message);
      }
      getData()
      setTimeout(getData, 1000)
    }

    async function getData() {
      //console.log("getting current data");
      const url = document.getElementById("ip").value + "/data"
      console.log("getting current data:   ", url);
      
      try {
        const response = await fetch(url);
        if (!response.ok) {
          throw new Error(`Response status: ${response.status}`);
        }
        const json = await response.text();
        console.log(json);
        line = JSON.parse(json)
        console.log()

        data[line.index] = line.val
        console.log(data);
        
      } catch (error) {
        console.error(error.message);
      }
      //butt()
    }

    async function downloadAll() {
      //console.log("Download all");
      const url = document.getElementById("ip").value + "/allData"
      console.log("Download all:  ",   url);
      try {
        const response = await fetch(url);
        if (!response.ok) {
          throw new Error(`Response status: ${response.status}`);
        }
        const json = await response.text();
        console.log(json);
      } catch (error) {
        console.error(error.message);
      }
    }


        </script>
</html>